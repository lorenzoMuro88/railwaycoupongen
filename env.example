# ============================================================================
# Server Configuration
# ============================================================================

# PORT - Porta su cui il server Express ascolta
# Tipo: Number
# Default: 3000
# Esempio: PORT=3000
# Quando necessaria: Opzionale (ha default)
PORT=3000

# DATA_DIR - Directory dove viene creato il database SQLite
# Tipo: String (path assoluto o relativo)
# Default: ./data
# Esempio: DATA_DIR=/app/data (produzione) o DATA_DIR=./data (sviluppo)
# Quando necessaria: Opzionale (ha default)
# Nota: Il database verrà creato automaticamente in data/coupons.db
DATA_DIR=./data

# UPLOADS_DIR - Directory dove vengono salvati gli upload (immagini header form)
# Tipo: String (path assoluto o relativo)
# Default: ./static/uploads
# Esempio: UPLOADS_DIR=/app/data/uploads
# Quando necessaria: Opzionale (ha default)
# Nota: Gli upload vengono serviti via endpoint protetto /api/uploads/:tenantSlug/:filename
UPLOADS_DIR=./static/uploads

# NODE_ENV - Ambiente di esecuzione (development, production, test)
# Tipo: String
# Default: Nessuno (determinato automaticamente)
# Esempio: NODE_ENV=production
# Quando necessaria: Opzionale (raccomandato in produzione)
# Note:
#   - In produzione: Abilita Content-Security-Policy, HSTS, Expect-CT, redirect HTTP→HTTPS
#   - In development: Disabilita CSP per debugging più facile
#   - Influenza comportamento helmet.js e altri middleware di sicurezza
NODE_ENV=development

# FORCE_HTTPS - Forza redirect HTTP→HTTPS in produzione
# Tipo: Boolean (stringa "true"/"false")
# Default: true
# Esempio: FORCE_HTTPS=true
# Quando necessaria: Opzionale (default abilitato in produzione)
# Note:
#   - Solo attivo quando NODE_ENV=production
#   - Redirecta tutte le richieste HTTP a HTTPS con status 301
#   - Disabilitare solo se si usa un reverse proxy che gestisce già il redirect
FORCE_HTTPS=true

# ============================================================================
# Database Configuration
# ============================================================================
# SQLite database will be created automatically in data/coupons.db
# Il database utilizza WAL (Write-Ahead Logging) per migliore concorrenza
# Timeout configurabile via DB_BUSY_TIMEOUT (default: 30000ms)

# ============================================================================
# Authentication (Session-based login system)
# ============================================================================
# Default users are created automatically on first run if auth_users table is empty.
# REQUIRED: You MUST set these values in production!
# - SuperAdmin: username=admin (manages entire system, can create/manage tenants)
# - Store: username=store (manages single tenant)

# SUPERADMIN_PASSWORD - Password per utente superadmin di default
# Tipo: String
# Default: Nessuno (REQUIRED)
# Quando necessaria: REQUIRED in produzione
# Nota: Username superadmin di default è "admin" (configurabile via SUPERADMIN_USERNAME)
# Generazione password sicura: openssl rand -base64 32 | head -c 20
# La password deve rispettare la policy: min 12 caratteri, maiuscole, minuscole, numeri, caratteri speciali
SUPERADMIN_PASSWORD=REQUIRED_CHANGE_ME_TO_SECURE_PASSWORD

# STORE_PASSWORD - Password per utente store di default
# Tipo: String
# Default: Nessuno (REQUIRED)
# Quando necessaria: REQUIRED in produzione
# Nota: Username store di default è "store"
# Generazione password sicura: openssl rand -base64 32 | head -c 20
# La password deve rispettare la policy: min 12 caratteri, maiuscole, minuscole, numeri, caratteri speciali
STORE_PASSWORD=REQUIRED_CHANGE_ME_TO_SECURE_PASSWORD

# ============================================================================
# Session Configuration
# ============================================================================

# SESSION_SECRET - Secret key per firmare le sessioni Express
# Tipo: String (almeno 64 caratteri raccomandati)
# Default: Nessuno (REQUIRED in produzione)
# Quando necessaria: REQUIRED in produzione (startup bloccato se mancante)
# Generazione: openssl rand -base64 48
# Note:
#   - In produzione: Startup fallisce se SESSION_SECRET non configurato
#   - In development: Genera secret random se non configurato (con warning)
SESSION_SECRET=REQUIRED_CHANGE_ME_TO_SECURE_RANDOM_SECRET

# SESSION_TIMEOUT_MS - Timeout sessione in millisecondi
# Tipo: Number
# Default: 86400000 (24 ore)
# Esempio: SESSION_TIMEOUT_MS=3600000 (1 ora)
# Quando necessaria: Opzionale
# Nota: Session non viene rinnovata ad ogni richiesta (rolling: false) per maggiore sicurezza
SESSION_TIMEOUT_MS=86400000

# DEFAULT_TENANT_SLUG - Slug del tenant di default
# Tipo: String
# Default: default
# Quando necessaria: Opzionale
# Nota: Usato quando ENFORCE_TENANT_PREFIX=false o per richieste senza tenant context
DEFAULT_TENANT_SLUG=default

# DEFAULT_TENANT_NAME - Nome del tenant di default
# Tipo: String
# Default: Default Tenant
# Quando necessaria: Opzionale
DEFAULT_TENANT_NAME=Default Tenant

# ENFORCE_TENANT_PREFIX - Forza uso di prefisso tenant nelle URL (/t/:tenantSlug/...)
# Tipo: Boolean (stringa "true"/"false")
# Default: false
# Quando necessaria: Opzionale
# Nota: Se true, tutte le richieste devono includere il prefisso tenant
ENFORCE_TENANT_PREFIX=false

# ============================================================================
# Rate Limiting Configuration
# ============================================================================

# LOGIN_WINDOW_MS - Finestra temporale per tentativi di login (in millisecondi)
# Tipo: Number
# Default: 600000 (10 minuti)
# Quando necessaria: Opzionale
LOGIN_WINDOW_MS=600000

# LOGIN_MAX_ATTEMPTS - Numero massimo di tentativi di login nella finestra temporale
# Tipo: Number
# Default: 10
# Quando necessaria: Opzionale
LOGIN_MAX_ATTEMPTS=10

# LOGIN_LOCK_MS - Durata del lock dopo superamento tentativi (in millisecondi)
# Tipo: Number
# Default: 1800000 (30 minuti)
# Quando necessaria: Opzionale
LOGIN_LOCK_MS=1800000

# UPLOAD_MAX_BYTES - Dimensione massima file upload (in bytes)
# Tipo: Number
# Default: 2097152 (2 MB)
# Quando necessaria: Opzionale
# Esempio: 5242880 per 5 MB
UPLOAD_MAX_BYTES=2097152

# SUBMIT_WINDOW_MS - Finestra temporale per rate limiting form submission (in millisecondi)
# Tipo: Number
# Default: 600000 (10 minuti)
# Quando necessaria: Opzionale
# Nota: Limita numero di submission per IP nella finestra temporale
SUBMIT_WINDOW_MS=600000

# SUBMIT_MAX_PER_IP - Numero massimo di submission per IP nella finestra temporale
# Tipo: Number
# Default: 20
# Quando necessaria: Opzionale
SUBMIT_MAX_PER_IP=20

# SUBMIT_LOCK_MS - Durata del lock dopo superamento limite submission (in millisecondi)
# Tipo: Number
# Default: 1800000 (30 minuti)
# Quando necessaria: Opzionale
SUBMIT_LOCK_MS=1800000

# EMAIL_DAILY_WINDOW_MS - Finestra temporale per limite email giornaliero (in millisecondi)
# Tipo: Number
# Default: 86400000 (24 ore)
# Quando necessaria: Opzionale
EMAIL_DAILY_WINDOW_MS=86400000

# EMAIL_MAX_PER_DAY - Numero massimo di email inviate allo stesso indirizzo per giorno
# Tipo: Number
# Default: 3
# Quando necessaria: Opzionale
EMAIL_MAX_PER_DAY=3

# EMAIL_LOCK_MS - Durata del lock dopo superamento limite email (in millisecondi)
# Tipo: Number
# Default: 86400000 (24 ore)
# Quando necessaria: Opzionale
EMAIL_LOCK_MS=86400000

# ============================================================================
# Audit Logging Configuration
# ============================================================================

# LOG_RETENTION_DAYS - Retention policy per audit logs (in giorni)
# Tipo: Number
# Default: 90
# Quando necessaria: Opzionale
# Nota: Logs più vecchi di questo periodo vengono automaticamente eliminati
#       per mantenere la dimensione della tabella system_logs gestibile
LOG_RETENTION_DAYS=90

# ============================================================================
# reCAPTCHA Configuration (Invisible v2/v3)
# ============================================================================
# reCAPTCHA può essere abilitato per proteggere il form di submission pubblico
# da bot e spam. Supporta sia reCAPTCHA v2 (Invisible) che v3.

# RECAPTCHA_ENABLED - Abilita verifica reCAPTCHA per form submission
# Tipo: Boolean (stringa "true"/"false")
# Default: false
# Quando necessaria: Opzionale
# Nota: Se abilitato, richiede RECAPTCHA_SITE_KEY e RECAPTCHA_SECRET
RECAPTCHA_ENABLED=false

# RECAPTCHA_SITE_KEY - Site key di reCAPTCHA (pubblica, usata nel frontend)
# Tipo: String
# Default: Nessuno
# Quando necessaria: Richiesta se RECAPTCHA_ENABLED=true
# Nota: Ottenibile da https://www.google.com/recaptcha/admin
RECAPTCHA_SITE_KEY=

# RECAPTCHA_SECRET - Secret key di reCAPTCHA (privata, usata nel backend)
# Tipo: String
# Default: Nessuno
# Quando necessaria: Richiesta se RECAPTCHA_ENABLED=true
# Nota: Ottenibile da https://www.google.com/recaptcha/admin
RECAPTCHA_SECRET=

# ============================================================================
# CORS Configuration
# ============================================================================

# ALLOWED_ORIGINS - Lista di origini permesse per CORS (comma-separated)
# Tipo: String (comma-separated list)
# Default: Nessuno (solo same-origin permesso)
# Esempio: ALLOWED_ORIGINS=https://app.example.com,https://admin.example.com
# Quando necessaria: Opzionale (necessaria solo se serve supportare cross-origin requests)
# Note:
#   - In development: Se non configurato, tutte le origini sono permesse per facilitare testing
#   - In production: Se non configurato, solo same-origin requests sono permesse
#   - Formato: URL completi senza trailing slash (es. https://example.com)
#   - Supporta credentials (cookies, auth headers) per origini whitelisted
# ALLOWED_ORIGINS=

# ============================================================================
# Session Store
# ============================================================================
# Usa lo store in-memory (predefinito). Redis non è più necessario.
# Le sessioni sono gestite da express-session con store in-memory.
# Per deployment multi-istanza, considerare l'uso di Redis o altro store condiviso.

# Note: The legacy Basic Auth variables below are no longer used
# but kept for backward compatibility. The new system uses the
# session-based authentication with the users created in the database.

# ============================================================================
# Email Configuration
# ============================================================================
# Scegli uno dei seguenti provider email:

# MAIL_PROVIDER - Provider email da utilizzare (mailgun, smtp, o nessuno)
# Tipo: String
# Default: Nessuno (emails loggate in console)
# Valori possibili: "mailgun", "smtp", o lasciare vuoto per development
# Quando necessaria: Opzionale (necessaria solo per invio email reale)

# Option 1: Mailgun (Recommended)
# Mailgun è il provider raccomandato per produzione. Richiede account Mailgun e dominio verificato.
MAIL_PROVIDER=mailgun
# MAILGUN_API_KEY - API key di Mailgun (privata)
# Ottenibile dal dashboard Mailgun: https://app.mailgun.com/app/account/security/api_keys
MAILGUN_API_KEY=your_mailgun_api_key_here
# MAILGUN_DOMAIN - Dominio Mailgun verificato
# Esempio: mg.example.com o send.coupongen.it
MAILGUN_DOMAIN=your_domain.mailgun.org
# MAILGUN_FROM - Indirizzo email mittente (può essere sovrascritto per tenant)
# Formato: "Nome <email@domain.com>"
MAILGUN_FROM=CouponGen <no-reply@send.coupongen.it>
# MAILGUN_REGION - Regione Mailgun (us, eu)
# Default: eu
MAILGUN_REGION=eu
# MAILGUN_TRACKING - Abilita tracking email (opens, clicks)
# Tipo: Boolean (stringa "true"/"false")
# Default: false
MAILGUN_TRACKING=false
# MAILGUN_REPLY_TO - Indirizzo email per risposte
MAILGUN_REPLY_TO=support@send.coupongen.it

# Option 2: SMTP (Alternative)
# Usa qualsiasi server SMTP standard (Gmail, SendGrid, AWS SES, etc.)
# MAIL_PROVIDER=smtp
# SMTP_HOST - Hostname del server SMTP
# Esempio: smtp.gmail.com, smtp.sendgrid.net
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT - Porta SMTP (587 per TLS, 465 per SSL, 25 per non sicuro)
# SMTP_PORT=587
# SMTP_SECURE - Usa SSL/TLS (true per porta 465, false per porta 587)
# Tipo: Boolean (stringa "true"/"false")
# SMTP_SECURE=false
# SMTP_USER - Username per autenticazione SMTP
# SMTP_USER=your_email@gmail.com
# SMTP_PASS - Password o app password per autenticazione SMTP
# Per Gmail: Usa App Password (non password account normale)
# SMTP_PASS=your_app_password

# Option 3: Development (No real email sending)
# Lascia tutte le impostazioni email vuote per loggare emails in console
# Utile per sviluppo e testing senza inviare email reali

# ============================================================================
# Email Template Configuration
# ============================================================================

# MAIL_SUBJECT - Oggetto email di default per coupon
# Tipo: String
# Default: "Il tuo coupon"
# Quando necessaria: Opzionale
# Nota: Può essere personalizzato per tenant via admin interface
MAIL_SUBJECT=Il tuo coupon

# MAIL_FROM - Indirizzo email mittente di default
# Tipo: String (formato: "Nome <email@domain.com>")
# Default: "CouponGen <no-reply@send.coupongen.it>"
# Quando necessaria: Opzionale
# Nota: Ogni tenant può personalizzare il nome mittente via admin interface.
#       Il dominio rimane sempre send.coupongen.it per deliverability.
#       Nome mittente di default per nuovi tenant: "CouponGen"
MAIL_FROM=CouponGen <no-reply@send.coupongen.it>

# MAIL_TEST_TO - Indirizzo email per test invio email
# Tipo: String (indirizzo email)
# Quando necessaria: Opzionale
# Nota: Usato per testare configurazione email senza inviare a utenti reali
MAIL_TEST_TO=test@example.com

# ============================================================================
# Default Discount Configuration
# ============================================================================

# DEFAULT_DISCOUNT_PERCENT - Percentuale sconto di default se nessuna campagna specificata
# Tipo: Number
# Default: 10
# Quando necessaria: Opzionale
# Nota: Usato quando viene generato un coupon senza campagna associata
DEFAULT_DISCOUNT_PERCENT=10

# ============================================================================
# Timeout Configuration (Optional - defaults sono ragionevoli)
# ============================================================================

# Server Timeout Configuration
# SERVER_KEEPALIVE_TIMEOUT - Timeout keepalive socket (in millisecondi)
# Tipo: Number
# Default: 65000 (65 secondi)
# SERVER_KEEPALIVE_TIMEOUT=65000

# SERVER_HEADERS_TIMEOUT - Timeout per ricezione headers HTTP (in millisecondi)
# Tipo: Number
# Default: 66000 (66 secondi)
# SERVER_HEADERS_TIMEOUT=66000

# SERVER_REQUEST_TIMEOUT - Timeout per richiesta HTTP completa (in millisecondi)
# Tipo: Number
# Default: 30000 (30 secondi)
# SERVER_REQUEST_TIMEOUT=30000

# SERVER_OVERALL_TIMEOUT - Timeout complessivo server (in millisecondi)
# Tipo: Number
# Default: 30000 (30 secondi)
# SERVER_OVERALL_TIMEOUT=30000

# Database Timeout Configuration
# DB_BUSY_TIMEOUT - Timeout per database locked (in millisecondi)
# Tipo: Number
# Default: 30000 (30 secondi)
# Nota: SQLite attende questo tempo prima di restituire errore se database è locked
# DB_BUSY_TIMEOUT=30000

# Email Timeout Configuration
# EMAIL_CONNECTION_TIMEOUT - Timeout per connessione SMTP/Mailgun (in millisecondi)
# Tipo: Number
# Default: 30000 (30 secondi)
# EMAIL_CONNECTION_TIMEOUT=30000

# EMAIL_SOCKET_TIMEOUT - Timeout per socket email (in millisecondi)
# Tipo: Number
# Default: 30000 (30 secondi)
# EMAIL_SOCKET_TIMEOUT=30000

# ============================================================================
# Security Notes & Best Practices
# ============================================================================
# IMPORTANTE: Prima di deployare in produzione, assicurati di:
#
# 1. Password e Autenticazione:
#    - Cambia SUPERADMIN_PASSWORD e STORE_PASSWORD con password forti
#    - Le password devono rispettare la policy: min 12 caratteri, maiuscole, minuscole, numeri, caratteri speciali
#    - Genera password sicure: openssl rand -base64 32 | head -c 20
#    - Solo 1 SuperAdmin user dovrebbe esistere nel sistema
#
# 2. Session Security:
#    - Cambia SESSION_SECRET con una stringa randomica sicura (almeno 64 caratteri)
#    - Genera secret: openssl rand -base64 48
#    - In produzione, SESSION_SECRET è REQUIRED (startup bloccato se mancante)
#
# 3. HTTPS e Transport Security:
#    - Usa HTTPS in produzione (NODE_ENV=production)
#    - FORCE_HTTPS=true abilita redirect automatico HTTP→HTTPS
#    - Configura certificati SSL/TLS validi
#
# 4. Email Configuration:
#    - Configura provider email (Mailgun raccomandato) per produzione
#    - Verifica dominio email per migliore deliverability
#    - Non lasciare impostazioni email vuote in produzione
#
# 5. CORS e Security Headers:
#    - Configura ALLOWED_ORIGINS per limitare accesso cross-origin
#    - Security headers sono configurati automaticamente via helmet.js
#    - CSP, HSTS, X-Frame-Options sono abilitati in produzione
#
# 6. Rate Limiting:
#    - Rate limiting è configurato per login, form submission, e email
#    - Aggiusta valori secondo necessità per il tuo caso d'uso
#
# 7. Database:
#    - Il database SQLite è creato automaticamente
#    - Considera backup regolari del database
#    - Per deployment multi-istanza, considera store sessioni condiviso (Redis)
#
# 8. Environment Variables:
#    - Non committare file .env nel repository
#    - Usa variabili d'ambiente o secret manager per valori sensibili
#    - Mantieni env.example aggiornato con tutte le variabili disponibili

<!doctype html>
<html lang="it">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Coupon Generato - Grazie!</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <link rel="stylesheet" href="/static/navigation.css" />
</head>
<body>
    <main class="container">
        <div class="text-center">
            <div id="heroHeader" style="width:100%; height:200px; border-radius:12px; background:#e7f0e7; background-size:cover; background-position:50% 50%; margin:0 auto 1rem auto; overflow:hidden; max-width:600px;"></div>
            <div class="card" style="max-width: 600px; margin: 0 auto;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">✓</div>
                <h1 id="thanksTitle" style="color: var(--accent-green); margin-bottom: 1rem;">Coupon Generato!</h1>
                
                <div class="success" style="margin: 2rem 0;">
                    <h3 id="thanksSubtitle" style="margin: 0 0 1rem 0; color: var(--accent-green);">Invio Completato</h3>
                    <p style="margin: 0; font-size: 1.1rem;">
                        Il tuo coupon personalizzato è stato inviato via email con QR code incluso.
                    </p>
                </div>
                
                <div style="background: var(--light-green); padding: 1.5rem; border-radius: 12px; margin: 2rem 0;">
                    <h4 id="whatNextTitle" style="color: var(--primary-green); margin: 0 0 1rem 0;">Cosa fare ora:</h4>
                    <ul style="text-align: left; color: var(--text-dark); margin: 0; padding-left: 1.5rem;">
                        <li>Controlla la tua casella email</li>
                        <li>Trova il coupon con il QR code allegato</li>
                        <li>Mostra il QR code o il codice al negozio</li>
                        <li>Goditi il tuo sconto!</li>
                    </ul>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                    <a id="thanksLink" href="/" class="primary" style="text-decoration: none; display: inline-block;">
                        Torna alla Home
                    </a>
                </div>
            </div>
        </div>
    </main>
    <footer class="site-footer">CouponGen</footer>
    <script>
        // Applica personalizzazioni estetiche salvate per l'header del form
        document.addEventListener('DOMContentLoaded', function() {
            applySavedCustomization();
        });

        function applySavedCustomization(){
            // Prova prima dal localStorage per risposta immediata, poi aggiorna con il server
            try {
                var local = localStorage.getItem('formCustomization');
                if (local) {
                    var cfg = JSON.parse(local);
                    if (cfg) applyUiConfig(cfg);
                }
            } catch(e) {}
            // Aggiorna con la versione pubblica dal server
            fetch('/api/form-customization').then(function(r){ return r.ok ? r.json() : null; }).then(function(cfg){
                if (cfg) applyUiConfig(cfg);
            }).catch(function(){ /* no-op */ });
        }

        function applyUiConfig(cfg){
            try {
                var primary = cfg.primaryColor || '#2d5a3d';
                var accent = cfg.accentColor || '#4a7c59';
                var bg = cfg.backgroundColor || '#faf8f3';
                var text = cfg.textColor || '#2c3e50';
                var font = cfg.fontFamily || "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";

                // Colori e font globali
                document.body.style.backgroundColor = bg;
                document.body.style.color = text;
                document.body.style.fontFamily = font;

                // Titoli coerenti con brand
                var t = document.getElementById('thanksTitle');
                if (t) { t.style.color = accent; }
                var st = document.getElementById('thanksSubtitle');
                if (st) { st.style.color = accent; }
                var wn = document.getElementById('whatNextTitle');
                if (wn) { wn.style.color = primary; }

                // Header hero: immagine o gradiente fallback
                var hero = document.getElementById('heroHeader');
                if (hero){
                    var headerUrl = cfg.headerImageUrl;
                    if (headerUrl){
                        hero.style.backgroundImage = "url('" + headerUrl + "')";
                        var fx = (typeof cfg.headerFocalX === 'number') ? cfg.headerFocalX : 0.5;
                        var fy = (typeof cfg.headerFocalY === 'number') ? cfg.headerFocalY : 0.5;
                        hero.style.backgroundPosition = Math.round(fx*100) + '% ' + Math.round(fy*100) + '%';
                    } else {
                        hero.style.backgroundImage = '';
                        hero.style.background = 'linear-gradient(135deg, ' + primary + ' 0%, ' + accent + ' 100%)';
                        hero.style.backgroundSize = 'cover';
                        hero.style.backgroundPosition = '50% 50%';
                    }
                }

                // Link custom per la pagina thanks
                var thanksLink = document.getElementById('thanksLink');
                if (thanksLink && cfg.customThanksUrl && cfg.customThanksUrl.trim() !== '') {
                    thanksLink.href = cfg.customThanksUrl;
                } else if (thanksLink) {
                    thanksLink.href = '/';
                }
            } catch(e) {
                console.warn('Impossibile applicare configurazione UI:', e);
            }
        }
    </script>
</body>
</html>


